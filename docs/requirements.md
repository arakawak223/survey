# アンケート結果分析アプリ — 要件定義書（案）

## 1. プロジェクト概要

### 1.1 目的
企業が実施するアンケート（従業員満足度調査、顧客満足度調査など）の結果を取り込み、
**項目分類・課題抽出・優良項目抽出・優先順位付け・可視化**を自動で行うWebアプリケーション。
各分析結果にはAIが初期コメントを自動生成し、ユーザーが自由に編集・加筆できる。

### 1.2 解決する課題
| 現状の課題 | 本アプリでの解決 |
|---|---|
| Excel手作業による集計に時間がかかる | CSV/Excelアップロードで自動集計 |
| 分析者のスキルにより結果がばらつく | 統一アルゴリズムで再現性のある分析 |
| 課題の優先度判断が属人的 | 重要度×満足度マトリクスで客観的に優先順位付け |
| レポート作成に工数がかかる | チャート・表を自動生成しエクスポート可能 |
| 分析コメントの作成が負担 | AIが初期コメントを自動生成、ユーザーは編集のみで完了 |

---

## 2. ユーザーと利用シナリオ

### 2.1 想定ユーザー
- **人事部門**: 従業員エンゲージメント調査の分析
- **経営企画部門**: 組織課題の把握と施策立案
- **CS部門**: 顧客満足度調査の分析

### 2.2 基本利用フロー
```
CSVアップロード → データ検証 → 自動分類 → 課題抽出 → 優良項目抽出 → 優先順位付け → AIコメント生成 → ユーザー編集 → チャート表示 → レポート出力
```

---

## 3. 機能要件

### 3.1 データ取り込み（F-001）
| 項目 | 内容 |
|---|---|
| 対応形式 | CSV, Excel (.xlsx) |
| データ検証 | 欠損値検出、型チェック、異常値警告 |
| プレビュー | アップロード後にデータプレビュー表示 |
| テンプレート | サンプルCSVテンプレートのダウンロード提供 |

**CSVフォーマット例:**
```csv
回答者ID,部署,Q1_仕事のやりがい,Q2_職場環境,Q3_給与待遇,Q4_上司との関係,Q5_成長機会
001,営業部,4,3,2,5,3
002,開発部,5,4,3,4,4
```
- 各設問は1〜5のリッカート尺度を想定（設定で変更可能）

### 3.2 アンケート項目の自動分類（F-002）
| 項目 | 内容 |
|---|---|
| 分類方法 | 設問名のキーワードマッチング + ユーザー定義カテゴリ |
| デフォルトカテゴリ | 職場環境 / 人間関係 / 報酬・待遇 / 成長・キャリア / 業務内容 / 経営・組織 |
| カスタマイズ | カテゴリの追加・編集・設問の手動再分類が可能 |

### 3.3 課題項目の抽出（F-003）
| 項目 | 内容 |
|---|---|
| 抽出ロジック | 平均スコアが閾値以下（デフォルト: 3.0）の項目を課題として抽出 |
| 補助指標 | 低評価（1-2）回答の割合、標準偏差（ばらつき） |
| 部署別比較 | 全社平均と各部署の差分を算出し、部署固有の課題を検出 |
| 経年比較 | 過去データがある場合、前回比でスコア低下した項目を検出 |
| **AIコメント** | 各課題項目に対してAIが改善提案コメントを自動生成（後述 3.8 参照） |

### 3.4 優良評価項目の抽出（F-004）  ※新規
| 項目 | 内容 |
|---|---|
| 抽出ロジック | 平均スコアが閾値以上（デフォルト: 4.0）の項目を優良項目として抽出 |
| 補助指標 | 高評価（4-5）回答の割合、スコアの安定性（標準偏差が小さい） |
| 部署別比較 | 全社平均を上回る部署の優良項目を検出し、好事例として提示 |
| 経年比較 | 過去データがある場合、前回比でスコア向上した項目を検出 |
| **AIコメント** | 各優良項目に対してAIが強みの要因分析・維持施策コメントを自動生成（後述 3.8 参照） |

### 3.5 重要度別の優先順位付け（F-005）
| 項目 | 内容 |
|---|---|
| 分析手法 | **重要度-満足度分析（ISA: Importance-Satisfaction Analysis）** |
| 重要度算出 | 各設問スコアと総合満足度の相関係数を重要度とする |
| 4象限マトリクス | 重点改善（高重要度×低満足度）/ 維持（高×高）/ 改善検討（低×低）/ 過剰（低×高） |
| 優先度ラベル | 高・中・低の3段階で自動ラベリング |
| **AIコメント** | 各象限の項目群に対してAIが総括コメントと推奨アクションを自動生成（後述 3.8 参照） |

### 3.6 可視化・チャート（F-006）
| チャート種別 | 用途 |
|---|---|
| **スコア一覧テーブル** | 全設問の平均値・中央値・標準偏差を一覧表示 |
| **棒グラフ** | カテゴリ別・設問別の平均スコア比較 |
| **レーダーチャート** | カテゴリ別のバランスを俯瞰 |
| **散布図（ISAマトリクス）** | 重要度×満足度の4象限プロット |
| **分布チャート（ヒストグラム）** | 各設問の回答分布 |
| **部署別ヒートマップ** | 部署×設問のスコアを色で可視化 |

### 3.7 レポート出力（F-007）
| 項目 | 内容 |
|---|---|
| 出力形式 | PDF, Excel |
| 内容 | サマリー、課題一覧、優良項目一覧、優先度マトリクス、全チャート、**AIコメント（編集後）** |

### 3.8 AIコメント生成・編集（F-008）  ※新規
| 項目 | 内容 |
|---|---|
| 対象機能 | F-003（課題抽出）、F-004（優良項目抽出）、F-005（優先順位付け） |
| 生成タイミング | 各分析完了時にAIが自動生成。ユーザー操作で再生成も可能 |
| AI生成内容 | 下表参照 |
| 編集機能 | リッチテキストエディタで自由に編集・加筆・削除が可能 |
| 編集履歴 | AI原文と編集後テキストの両方を保持。原文に戻す機能あり |
| レポート反映 | 編集後のコメントがそのままレポート（PDF/Excel）に出力される |

**AIコメント生成内容:**
| 対象 | 生成されるコメント内容 |
|---|---|
| 課題項目（F-003） | 課題の要因分析、想定される影響、具体的な改善提案 |
| 優良項目（F-004） | 高評価の要因分析、組織の強みとしての位置づけ、維持・強化の施策 |
| 優先順位（F-005） | 各象限の総括、重点改善項目の推奨アクション、改善ロードマップ案 |

**AIコメントのUI例:**
```
┌─────────────────────────────────────────────┐
│ 📋 Q3_給与待遇（平均: 2.3 / 優先度: 高）       │
├─────────────────────────────────────────────┤
│ ┌─ AIコメント ──────────────── [✏️編集] [🔄再生成] ─┐ │
│ │                                             │ │
│ │ 給与待遇のスコアは全項目中最も低く、特に営業部  │ │
│ │ （平均1.8）で顕著です。低評価回答が62%を占め、  │ │
│ │ 離職リスクとの相関が懸念されます。              │ │
│ │                                             │ │
│ │ 【改善提案】                                 │ │
│ │ ・市場水準との報酬ベンチマーク調査の実施        │ │
│ │ ・成果連動型インセンティブ制度の検討           │ │
│ │                                             │ │
│ └─────────────────────────────────────────────┘ │
│                          最終編集: 2026-02-05   │
└─────────────────────────────────────────────┘
```

### 3.9 ダッシュボード（F-009）
| 項目 | 内容 |
|---|---|
| サマリーカード | 回答数、全体平均、課題項目数、優良項目数、最重要課題 |
| フィルター | 部署別、カテゴリ別で絞り込み |

---

## 4. 非機能要件

| 項目 | 要件 |
|---|---|
| パフォーマンス | 10,000件の回答データを10秒以内に分析完了 |
| ブラウザ対応 | Chrome, Edge, Safari（最新2バージョン） |
| レスポンシブ | PC画面（1024px以上）を主対象。タブレット対応は任意 |
| データ保存 | ブラウザローカル（IndexedDB）。サーバー不要で動作 |
| セキュリティ | アップロードデータは自社サーバーに送信しない。AI API へは統計サマリーのみ送信（個別回答データは送信しない） |
| AI連携 | APIキー未設定でも全機能が利用可能（AIコメント欄は手動入力）。API設定時は自動生成が有効化 |

---

## 5. 技術スタック（案）

```
フロントエンド:  React 18 + TypeScript
ビルドツール:    Vite
UIフレームワーク: Tailwind CSS + shadcn/ui
チャート:        Recharts
データ処理:      クライアントサイドJS（Papa Parse でCSV解析）
Excel入出力:     SheetJS (xlsx)
PDF出力:         jsPDF + html2canvas
状態管理:        Zustand
データ永続化:    IndexedDB (Dexie.js)
AI連携:          Claude API (Anthropic)  ※APIキーはブラウザローカルに保存
テスト:          Vitest + React Testing Library
```

### 5.1 技術選定の理由
- **クライアント完結型**: 企業のアンケートデータは機密性が高いため、自社サーバーを持たない設計
- **React + TypeScript**: 型安全性による保守性の確保
- **Recharts**: React との親和性が高く、必要なチャート種別を網羅
- **Zustand**: 軽量で学習コストが低い状態管理
- **Claude API**: AIコメント生成に使用。APIキーはユーザーのブラウザに保存し、サーバーを経由しない

### 5.2 AIコメント機能の設計方針
- ブラウザからClaude APIへ直接リクエストする構成（BFF不要）
- APIキーはユーザーが設定画面で入力し、ブラウザのlocalStorageに暗号化保存
- AIへ送信するデータは統計サマリー（平均値・割合等）のみとし、個別回答の生データは送信しない
- API未設定時はAIコメント欄を空欄にし、ユーザーが手動入力可能

---

## 6. 画面構成

```
┌─────────────────────────────────────────┐
│  ヘッダー（アプリ名 / ナビゲーション）      │
├─────────┬───────────────────────────────┤
│         │                               │
│ サイド   │   メインコンテンツ              │
│ バー     │                               │
│         │   ① ダッシュボード              │
│ ・データ  │   ② データ取り込み             │
│ ・分析   │   ③ 分類設定                  │
│ ・チャート │   ④ 分析結果（課題・優良・優先度）│
│ ・レポート │   ⑤ AIコメント編集             │
│ ・設定   │   ⑥ チャート・可視化           │
│         │   ⑦ レポート出力               │
│         │   ⑧ 設定（APIキー等）           │
│         │                               │
└─────────┴───────────────────────────────┘
```

### 画面一覧
| # | 画面名 | 概要 |
|---|---|---|
| 1 | ダッシュボード | サマリーカード、主要チャート、課題・優良ハイライト |
| 2 | データ取り込み | ファイルアップロード、データプレビュー、検証結果 |
| 3 | 分類設定 | カテゴリ管理、設問とカテゴリの紐付け編集 |
| 4 | 分析結果 | 課題一覧、優良項目一覧、優先度マトリクス、部署比較 + 各項目のAIコメント表示・編集 |
| 5 | チャート・可視化 | 各種チャートの表示・フィルター操作 |
| 6 | レポート出力 | 出力内容選択（AIコメント含む）、プレビュー、ダウンロード |
| 7 | 設定 | APIキー管理、閾値設定、カスタマイズ |

---

## 7. データモデル

```typescript
// アンケートプロジェクト
interface SurveyProject {
  id: string;
  name: string;
  description: string;
  createdAt: Date;
  updatedAt: Date;
}

// 設問定義
interface Question {
  id: string;
  projectId: string;
  key: string;           // CSVカラム名
  label: string;         // 表示名
  categoryId: string;    // 分類カテゴリ
  scaleMin: number;      // 尺度の最小値（デフォルト1）
  scaleMax: number;      // 尺度の最大値（デフォルト5）
}

// カテゴリ
interface Category {
  id: string;
  name: string;
  color: string;         // チャート表示色
  order: number;         // 表示順
}

// 回答データ
interface Response {
  id: string;
  projectId: string;
  respondentId: string;
  department: string;
  answers: Record<string, number>;  // questionKey -> score
}

// 分析結果
interface AnalysisResult {
  questionId: string;
  mean: number;          // 平均値
  median: number;        // 中央値
  stdDev: number;        // 標準偏差
  lowRatio: number;      // 低評価割合(1-2)
  highRatio: number;     // 高評価割合(4-5)
  importance: number;    // 重要度（相関係数）
  priority: 'high' | 'medium' | 'low';
  quadrant: 'improve' | 'maintain' | 'monitor' | 'excess';
  extractionType: 'issue' | 'excellent' | 'neutral'; // 課題 / 優良 / 該当なし
}

// AIコメント
interface AIComment {
  id: string;
  projectId: string;
  targetType: 'issue' | 'excellent' | 'priority_quadrant'; // 紐付け先の種別
  targetId: string;           // 紐付け先のID（questionId or quadrant名）
  aiGeneratedText: string;    // AI生成の原文（変更不可で保持）
  editedText: string;         // ユーザー編集後のテキスト
  isEdited: boolean;          // ユーザーが編集済みか
  generatedAt: Date;          // AI生成日時
  editedAt: Date | null;      // 最終編集日時
}
```

---

## 8. 開発フェーズ

### Phase 1: 基盤 + データ取り込み
- プロジェクトセットアップ（Vite + React + TypeScript）
- 共通レイアウト（ヘッダー、サイドバー、ルーティング）
- CSV/Excelアップロード・パース・バリデーション
- データプレビュー画面

### Phase 2: 分析エンジン
- 基本統計量の算出（平均、中央値、標準偏差）
- カテゴリ自動分類
- 課題抽出ロジック
- 優良評価項目の抽出ロジック
- 重要度-満足度分析（ISA）
- 優先度ラベリング

### Phase 3: AIコメント機能
- 設定画面（APIキー管理）
- Claude API連携の実装
- 課題項目へのAIコメント生成
- 優良項目へのAIコメント生成
- 優先順位結果へのAIコメント生成
- コメント編集UI（リッチテキストエディタ、原文復元、再生成）

### Phase 4: 可視化
- スコア一覧テーブル
- 棒グラフ、レーダーチャート
- ISAマトリクス散布図
- 分布ヒストグラム
- 部署別ヒートマップ
- ダッシュボード

### Phase 5: レポート + 仕上げ
- PDF/Excelエクスポート（AIコメント含む）
- データ永続化（IndexedDB）
- レスポンシブ調整
- テスト

---

## 9. 前提条件・制約

- アンケートはリッカート尺度（数値回答）を主対象とする
- 自由記述（テキスト）の分析は本バージョンのスコープ外
- 認証・マルチユーザー機能は本バージョンのスコープ外
- AIコメント機能の利用にはインターネット接続とClaude APIキーが必要
- AIコメント機能未使用時はオフラインで動作可能（手動コメント入力は可能）
